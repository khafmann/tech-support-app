# tech-support-app

---

### Что реализовано в данной версии сервиса:

- Принятие и сохранение заявки в БД. При регистрации заявки ему сразу присваивается статус `ACCEPTED`, то есть принят в работу. В этом этапе можно реализовать валидацию заявки, например проверять существует ли пользователь и проверять его права.
- Обработка заявки в данной реализации позволяет менять статус и дополнять поле `description`. При изменении статуса есть проверка не изменили ли статус на предыдущее состояние и не обновляет ли пользователь статус на то же состояние в котором находится. Можно реализовать отдельный сервис и таблицу где будет дополняться фронт работ в описании и подробнее вести историю цикла ремонта.
- В итоге когда заявке присваивается конечный статус `FINISHED`, то есть окончен, пользователю отправляется уведомление по email. Тут я сымитировал отправку сообщения в топик Kafka, пока что без текста. Можно вынести дальнейшую обработку сообщений и проверку его успешной доставки в другом микросервисе. Так же можно расширить функционал, например отправку по SMS или в чат-бот (Whatsapp или Telegram).

---

### Как потестировать и начать работу:

1. Создаем тестового пользователя: 
- POST ```localhost:8080/create-user```
> В данной реализации я его "захардкодил" чтобы вам было легче тестировать отправку сообщения. В данный момент этот пользователь нужен для отправки сообщения. Привязки заявки по нему пока не реализован:

2. Создаем заявку: 
- POST ``localhost:8080/api/request-processing``
В теле цикла: 
```JSON
{
  "userId": 1
}
```

3. Получение заявок по id заявки или по статусу: 
- GET `localhost:8080/api/request-processing/get-by-id/{user-id}`
- GET `localhost:8080/api/request-processing/get-by-status/{status-id}`

4. Изменение статуса и описания:
- PATCH `localhost:8080/api/request-processing/change-status/{request-id}`
В теле цикла:
```JSON
{
  "statusId": 2,
  "description": "Текст"
}
```
> Если присвоить statusId = 4, то будет вызван метод отправки уведомления пользователю