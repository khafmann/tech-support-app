# tech-support-app

### Стэк:
- Java 21
- Spring 3.5.0
- Maven 3.9.9
- PostgreSQL 16

---

### Что реализовано в данной версии сервиса:

- Принятие и сохранение заявки в БД. При регистрации заявки ему сразу присваивается статус `ACCEPTED`, то есть принят в работу. В этом этапе можно реализовать валидацию заявки, например проверять существует ли пользователь и проверять его права.
- Обработка заявки в данной реализации позволяет менять статус и дополнять поле `description`. При изменении статуса есть проверка не изменили ли статус на предыдущее состояние и не обновляет ли пользователь статус на то же состояние в котором находится. Можно реализовать отдельный сервис и таблицу где будет дополняться фронт работ в описании и подробнее вести историю цикла ремонта.
- В итоге когда заявке присваивается конечный статус `FINISHED`, то есть окончен, пользователю отправляется уведомление по email. Тут я сымитировал отправку сообщения в топик Kafka, пока что без текста. Можно вынести дальнейшую обработку сообщений и проверку его успешной доставки в другом микросервисе. Так же можно расширить функционал, например отправку по SMS или в чат-бот (Whatsapp или Telegram).

---

### Запускаем проект:

### 1. Собираем JAR файл:
- Любым удобным способом: в IntelliJ IDEA или на Linux командой `mvn clean package` в корне проекта

### 2. Собираем и запускаем контейнеры:
- Выполните команду `docker-compose up --build` в корне проекта, где расположен файл `docker-compose.yml`
> Эта команда соберёт и запустит необходимые контейнеры (Убедитесь, что Docker установлен и запущен)

### 3. Создаем тестового пользователя: 
- POST ```localhost:8080/create-user```
> В данной реализации я его "захардкодил" чтобы вам было легче тестировать отправку сообщения. В данный момент этот пользователь нужен для отправки сообщения. Привязки заявки по нему пока не реализован:

### 4. Создаем заявку: 
- POST ``localhost:8080/api/request-processing``
В теле цикла: 
```JSON
{
  "userId": 1
}
```

### 5. Получение заявок по id заявки или по статусу: 
- GET `localhost:8080/api/request-processing/get-by-id/{user-id}`
- GET `localhost:8080/api/request-processing/get-by-status/{status-id}`

### 6. Изменение статуса и описания:
- PATCH `localhost:8080/api/request-processing/change-status/{request-id}`
В теле цикла:
```JSON
{
  "statusId": 2,
  "description": "Текст"
}
```
> Если присвоить statusId = 4, то будет вызван метод отправки уведомления пользователю